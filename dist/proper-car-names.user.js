// ==UserScript==
// @name         Proper Car Names
// @namespace    diicot
// @version      1.0.1
// @author       mavri [2402357]
// @description  Who the fuck likes the new names? (except the tribute ones)
// @downloadURL  https://github.com/LeoMavri/Proper-Car-Names/raw/main/dist/proper-car-names.user.js
// @updateURL    https://github.com/LeoMavri/Proper-Car-Names/raw/main/dist/proper-car-names.user.js
// @match        www.torn.com/loader.php?sid=racing*
// ==/UserScript==

(function () {
	'use strict';

	const I=(n,t)=>Array.prototype.slice.call(n,t);let N=null;typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?N=self:typeof global<"u"?N=global:window&&(N=window);const C=N,V=N.document,_=["load","loadend","loadstart"],X=["progress","abort","error","timeout"],z=n=>["returnValue","totalSize","position"].includes(n),H=function(n,t){for(let e in n){if(z(e))continue;const r=n[e];try{t[e]=r;}catch{}}return t},$=function(n,t,e){const r=o=>function(s){const a={};for(let f in s){if(z(f))continue;const d=s[f];a[f]=d===t?e:d;}return e.dispatchEvent(o,a)};for(let o of Array.from(n))e._has(o)&&(t[`on${o}`]=r(o));},J=function(n){if(V&&V.createEventObject!=null){const t=V.createEventObject();return t.type=n,t}try{return new Event(n)}catch{return {type:n}}},j=function(n){let t={};const e=o=>t[o]||[],r={};return r.addEventListener=function(o,s,a){t[o]=e(o),!(t[o].indexOf(s)>=0)&&(a=a===void 0?t[o].length:a,t[o].splice(a,0,s));},r.removeEventListener=function(o,s){if(o===void 0){t={};return}s===void 0&&(t[o]=[]);const a=e(o).indexOf(s);a!==-1&&e(o).splice(a,1);},r.dispatchEvent=function(){const o=I(arguments),s=o.shift();n||(o[0]=H(o[0],J(s)),Object.defineProperty(o[0],"target",{writable:!1,value:this}));const a=r[`on${s}`];a&&a.apply(r,o);const f=e(s).concat(e("*"));for(let d=0;d<f.length;d++)f[d].apply(r,o);},r._has=o=>!!(t[o]||r[`on${o}`]),n&&(r.listeners=o=>I(e(o)),r.on=r.addEventListener,r.off=r.removeEventListener,r.fire=r.dispatchEvent,r.once=function(o,s){var a=function(){return r.off(o,a),s.apply(null,arguments)};return r.on(o,a)},r.destroy=()=>t={}),r},K=`\r
`,ee=function(n){return Object.entries(n).map(([r,o])=>`${r.toLowerCase()}: ${o}`).join(K)},te=function(n,t){const e=n.split(K);t==null&&(t={});for(let r of e)if(/([^:]+):\s*(.+)/.test(r)){const o=RegExp.$1!=null?RegExp.$1.toLowerCase():void 0,s=RegExp.$2;t[o]==null&&(t[o]=s);}return t},ne=function(n,t){switch(typeof n){case"object":return ee(n);case"string":return te(n,t)}return []};var B={convert:ne};const M=j(!0),U=n=>n===void 0?null:n,O=C.XMLHttpRequest,x=function(){const t=new O,e={};let r=null,o,s,a;var f=0;const d=function(){if(a.status=r||t.status,r!==-1&&(a.statusText=t.statusText),r!==-1){const c=B.convert(t.getAllResponseHeaders());for(let u in c){const h=c[u];if(!a.headers[u]){const p=u.toLowerCase();a.headers[p]=h;}}return}},v=function(){if(!t.responseType||t.responseType==="text"){a.text=t.responseText,a.data=t.responseText;try{a.xml=t.responseXML;}catch{}}else t.responseType==="document"?(a.xml=t.responseXML,a.data=t.responseXML):a.data=t.response;"responseURL"in t&&(a.finalUrl=t.responseURL);},m=function(){i.status=a.status,i.statusText=a.statusText;},T=function(){"text"in a&&(i.responseText=a.text),"xml"in a&&(i.responseXML=a.xml),"data"in a&&(i.response=a.data),"finalUrl"in a&&(i.responseURL=a.finalUrl);},l=function(){o||i.dispatchEvent("load",{}),i.dispatchEvent("loadend",{}),o&&(i.readyState=0);},y=function(c){for(;c>f&&f<4;)i.readyState=++f,f===1&&i.dispatchEvent("loadstart",{}),f===2&&m(),f===4&&(m(),T()),i.dispatchEvent("readystatechange",{}),f===4&&(e.async===!1?l():setTimeout(l,0));},w=function(c){if(c!==4){y(c);return}const u=M.listeners("after");var h=function(){if(u.length>0){const p=u.shift();p.length===2?(p(e,a),h()):p.length===3&&e.async?p(e,a,h):h();}else y(4);};h();};var i=j();e.xhr=i,t.onreadystatechange=function(c){try{t.readyState===2&&d();}catch{}t.readyState===4&&(s=!1,d(),v()),w(t.readyState);};const S=function(){o=!0;};i.addEventListener("error",S),i.addEventListener("timeout",S),i.addEventListener("abort",S),i.addEventListener("progress",function(c){f<3?w(3):t.readyState<=3&&i.dispatchEvent("readystatechange",{});}),"withCredentials"in t&&(i.withCredentials=!1),i.status=0;for(let c of Array.from(X.concat(_)))i[`on${c}`]=null;if(i.open=function(c,u,h,p,A){f=0,o=!1,s=!1,e.headers={},e.headerNames={},e.status=0,e.method=c,e.url=u,e.async=h!==!1,e.user=p,e.pass=A,a={},a.headers={},w(1);},i.send=function(c){let u,h;for(u of ["type","timeout","withCredentials"])h=u==="type"?"responseType":u,h in i&&(e[u]=i[h]);e.body=c;const p=function(){$(X,t,i),i.upload&&$(X.concat(_),t.upload,i.upload),s=!0,t.open(e.method,e.url,e.async,e.user,e.pass);for(u of ["type","timeout","withCredentials"])h=u==="type"?"responseType":u,u in e&&(t[h]=e[u]);for(let E in e.headers){const R=e.headers[E];E&&t.setRequestHeader(E,R);}t.send(e.body);},A=M.listeners("before");var G=function(){if(!A.length)return p();const E=function(b){if(typeof b=="object"&&(typeof b.status=="number"||typeof a.status=="number")){H(b,a),"data"in b||(b.data=b.response||b.text),w(4);return}G();};E.head=function(b){H(b,a),w(2);},E.progress=function(b){H(b,a),w(3);};const R=A.shift();R.length===1?E(R(e)):R.length===2&&e.async?R(e,E):E();};G();},i.abort=function(){r=-1,s?t.abort():i.dispatchEvent("abort",{});},i.setRequestHeader=function(c,u){const h=c!=null?c.toLowerCase():void 0,p=e.headerNames[h]=e.headerNames[h]||c;e.headers[p]&&(u=e.headers[p]+", "+u),e.headers[p]=u;},i.getResponseHeader=c=>U(a.headers[c?c.toLowerCase():void 0]),i.getAllResponseHeaders=()=>U(B.convert(a.headers)),t.overrideMimeType&&(i.overrideMimeType=function(){t.overrideMimeType.apply(t,arguments);}),t.upload){let c=j();i.upload=c,e.upload=c;}return i.UNSENT=0,i.OPENED=1,i.HEADERS_RECEIVED=2,i.LOADING=3,i.DONE=4,i.response="",i.responseText="",i.responseXML=null,i.readyState=0,i.statusText="",i};x.UNSENT=0;x.OPENED=1;x.HEADERS_RECEIVED=2;x.LOADING=3;x.DONE=4;var q={patch(){O&&(C.XMLHttpRequest=x);},unpatch(){O&&(C.XMLHttpRequest=O);},Native:O,Xhook:x};function oe(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e}function re(n,t,e,r){function o(s){return s instanceof e?s:new e(function(a){a(s);})}return new(e||(e=Promise))(function(s,a){function f(m){try{v(r.next(m));}catch(T){a(T);}}function d(m){try{v(r.throw(m));}catch(T){a(T);}}function v(m){m.done?s(m.value):o(m.value).then(f,d);}v((r=r.apply(n,[])).next());})}const L=C.fetch;function ae(n){const t=["method","headers","body","mode","credentials","cache","redirect","referrer","referrerPolicy","integrity","keepalive","signal","url"];let e={};return t.forEach(r=>e[r]=n[r]),e}function W(n){return n instanceof Headers?Z([...n.entries()]):Array.isArray(n)?Z(n):n}function Z(n){return n.reduce((t,[e,r])=>(t[e]=r,t),{})}const Y=function(n,t={headers:{}}){let e=Object.assign(Object.assign({},t),{isFetch:!0});if(n instanceof Request){const s=ae(n),a=Object.assign(Object.assign({},W(s.headers)),W(e.headers));e=Object.assign(Object.assign(Object.assign({},s),t),{headers:a,acceptedRequest:!0});}else e.url=n;const r=M.listeners("before"),o=M.listeners("after");return new Promise(function(s,a){let f=s;const d=function(l){if(!o.length)return f(l);const y=o.shift();return y.length===2?(y(e,l),d(l)):y.length===3?y(e,l,d):d(l)},v=function(l){if(l!==void 0){const y=new Response(l.body||l.text,l);s(y),d(y);return}m();},m=function(){if(!r.length){T();return}const l=r.shift();if(l.length===1)return v(l(e));if(l.length===2)return l(e,v)},T=()=>re(this,void 0,void 0,function*(){const{url:l,isFetch:y,acceptedRequest:w}=e,i=oe(e,["url","isFetch","acceptedRequest"]);return n instanceof Request&&i.body instanceof ReadableStream&&(i.body=yield new Response(i.body).text()),L(l,i).then(S=>d(S)).catch(function(S){return f=a,d(S),a(S)})});m();})};var P={patch(){L&&(C.fetch=Y);},unpatch(){L&&(C.fetch=L);},Native:L,Xhook:Y};const g=M;g.EventEmitter=j;g.before=function(n,t){if(n.length<1||n.length>2)throw "invalid hook";return g.on("before",n,t)};g.after=function(n,t){if(n.length<2||n.length>3)throw "invalid hook";return g.on("after",n,t)};g.enable=function(){q.patch(),P.patch();};g.disable=function(){q.unpatch(),P.unpatch();};g.XMLHttpRequest=q.Native;g.fetch=P.Native;g.headers=B.convert;g.enable();const k={"Yotsuhada EVX":"Mitsubishi Evo X","Stålhög 860":"Volvo 850","Alpha Milano 156":"Alfa Romeo 156","Bavaria X5":"BMW X5","Coche Basurero":"Seat Leon Cupra","Bedford Nova":"Vauxhall Astra GSI","Verpestung Sport":"Volkswagen Golf GTI","Echo S3":"Audi S3","Volt RS":"Ford Focus RS","Edomondo S2":"Honda S2000","Nano Cavalier":"Mini Cooper S","Colina Tanprice":"Ford Sierra Cosworth","Cosmos EX":"Lotus Exige","Bedford Racer":"Vauxhall Corsa","Sturmfahrt 111":"Porsche 911 GT3","Tsubasa Impressor":"Subaru Impreza STI","Wington GGU":"TVR Sagaris","Weston Marlin 177":"Aston Martin One-77","Echo R8":"Audi R8","Stormatti Casteon":"Bugatti Veyron","Lolo 458":"Ferrari 458","Lambrini Torobravo":"Lamborghini Gallardo","Veloria LFA":"Lexus LFA","Mercia SLR":"Mercedes SLR","Zaibatsu GT-R":"Nissan GT-R","Edomondo Localé":"Honda Civic","Edomondo NSX":"Honda NSX","Echo Quadrato":"Audi TT Quattro","Bavaria M5":"BMW M5","Bavaria Z8":"BMW Z8","Chevalier CZ06":"Chevrolet Corvette Z06","Dart Rampager":"Dodge Charger","Knight Firebrand":"Pontiac Firebird","Volt GT":"Ford GT","Invader H3":"Hummer H3","Echo S4":"Audi S4","Edomondo IR":"Honda Integra R","Edomondo ACD":"Honda Accord","Tabata RM2":"Toyota MR2","Verpestung Insecta":"Volkswagen Beetle","Chevalier CVR":"Chevrolet Cavalier","Volt MNG":"Ford Mustang",Trident:"Reliant Robin","Oceania SS":"Holden SS","Limoen Saxon":"Citroen Saxo","Nano Pioneer":"Classic Mini","Vita Bravo":"Fiat Punto","Zaibatsu Macro":"Nissan Micra","Çagoutte 10-6":"Peugeot 106","Papani Colé":"Renault Clio"};function F(n,t){return new Promise((e,r)=>{let o;if(document.querySelectorAll(n).length)return e(document.querySelector(n));const s=new MutationObserver(()=>{if(document.querySelectorAll(n).length)return s.disconnect(),o!=null&&clearTimeout(o),e(document.querySelector(n))});s.observe(document.body,{childList:!0,subtree:!0}),t&&(o=setTimeout(()=>{s.disconnect(),e(null);},t));})}async function Q(){await F(".car img",15e3);const n=document.querySelectorAll(".car img");if(!n.length){console.warn("Failed to find car images");return}n.forEach(t=>{const e=k[t.title.trim()]||t.title;t.title=e;});}async function D(){await F(".model",1e4),document.querySelectorAll(".model").forEach(t=>{var o;const e=t.children[0];if(!e){console.warn("No child element found in",t);return}const r=k[((o=e.textContent)==null?void 0:o.trim())||""]||e.textContent;e.textContent=r;});}async function ie(){var o;const n=await F(".msg.right-round",1e4);if(!n){console.warn("Failed to find car change element");return}const t=(o=n==null?void 0:n.textContent)==null?void 0:o.trim();if(!t){console.warn("Failed to find text for car change");return}const e=t.match(/You selected your (.+) for this race/);if(!e){console.warn("Failed to match text for car change");return}const r=k[e[1].trim()]||e[1];n.textContent=`You selected your ${r} for this race`;}async function se(){var e;const n=await F(".msg.right-round b");if(!n){console.warn("Failed to find upgrade element");return}const t=k[((e=n.textContent)==null?void 0:e.trim())||""]||n.textContent;n.textContent=t;}g.after((n,t)=>{const e=n.url;if(e.includes("racing")){if(console.debug(e),e.includes("&tab=parts&section=addParts")){se();return}if(e.includes("sid=racing&tab=race")){D(),Q();return}e.includes("sid=racing&tab=cars&section=changeRacingCar")&&ie(),D();}});D();Q();

})();